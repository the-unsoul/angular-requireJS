define(["app","ng-map","map","async!http://maps.googleapis.com/maps/api/js?sensor=false"],function(e){e.controller("mapCtrl",["$scope","mapServices",function(e,o){e.map={center:{latitude:45,longitude:-73},zoom:8},e.markers=[];var n=function(o){return e.markers=o,e.coords=_.map(o,function(e){return new google.maps.LatLng(e.longitude,e.latitude)}),"pushed: "+o.length+" markers to local strore"},t=function(o){console.log(o),e.bounds=new google.maps.LatLngBounds;for(var n=0;n<e.coords.length;n++)e.bounds.extend(e.coords[n]);e.map.center={latitude:e.bounds.getCenter().k,longitude:e.bounds.getCenter().D},e.fitBounds={northeast:{latitude:e.bounds.va.j,longitude:e.bounds.va.k},southwest:{latitude:e.bounds.Ca.j,longitude:e.bounds.Ca.k}}};o.getMarkers("markers").then(n,o.errorHandler).then(t,o.errorHandler),e.$watch("markers",function(e,o){e!=o&&console.log("$watch: markers fetched")})}])});